<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯»å®æ¸¸æˆï¼šå¤è€ç¥åº™çš„è°œé¢˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .page {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.8s ease, opacity 0.8s ease;
            opacity: 0;
            transform: translateX(100%);
            position: absolute;
            pointer-events: none;
        }
        
        .page.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }
        
        .page.previous {
            transform: translateX(-100%);
        }
        
        .container {
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            color: #ffd700;
        }
        
        h2 {
            margin-bottom: 15px;
            color: #f39c12;
        }
        
        h3 {
            margin: 15px 0;
            color: #ffd700;
        }
        
        p {
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .scene {
            height: 300px;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            background: #2c3e50;
            border: 3px solid #8b6914;
        }
        
        .scene-content {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .character {
            width: 60px;
            height: 60px;
            background: #e74c3c;
            border-radius: 50%;
            position: absolute;
            transition: all 1s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .object {
            position: absolute;
            transition: all 0.5s ease;
        }
        
        .book {
            width: 40px;
            height: 50px;
            background: #8e44ad;
            border-radius: 5px;
            top: 100px;
            left: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .temple {
            width: 120px;
            height: 100px;
            background: #e74c3c;
            border-radius: 10px 10px 0 0;
            bottom: 50px;
            right: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .cave {
            width: 80px;
            height: 60px;
            background: #34495e;
            border-radius: 40px 40px 0 0;
            bottom: 50px;
            left: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }
        
        .mountain {
            width: 150px;
            height: 120px;
            background: #2ecc71;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            bottom: 50px;
            left: 300px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 20px;
            font-size: 30px;
        }
        
        .treasure {
            width: 60px;
            height: 40px;
            background: #ffd700;
            border: 3px solid #b8860b;
            border-radius: 5px;
            bottom: 80px;
            right: 170px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            opacity: 0;
            transform: scale(0);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            height: 20px;
            background: #34495e;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            transition: width 0.5s ease;
        }
        
        .status-text {
            text-align: center;
            font-size: 1.2rem;
            min-height: 60px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .message-log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            margin-top: 20px;
            text-align: left;
        }
        
        .message {
            padding: 8px;
            border-left: 3px solid #f39c12;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 5px 5px 0;
            animation: fadeIn 0.5s ease;
        }
        
        .success { border-left-color: #2ecc71; }
        .danger { border-left-color: #e74c3c; }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .animated-text {
            animation: fadeIn 1s ease;
        }
        
        /* å…¨æ™¯åœ°å›¾æ ·å¼ - ä¼˜åŒ–ç‰ˆ */
        .map-container {
            width: 100%;
            height: 450px;
            position: relative;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="450" viewBox="0 0 800 450"><rect width="800" height="450" fill="%231e3c72"/><path d="M100,350 L150,300 L200,330 L250,250 L300,300 L350,230 L400,270 L450,200 L500,250 L550,170 L600,230 L650,150 L700,200" stroke="%23395d33" stroke-width="10" fill="none"/><path d="M100,350 L150,300 L200,330 L250,250 L300,300 L350,230 L400,270 L450,200 L500,250 L550,170 L600,230 L650,150 L700,200" stroke="%235e9c4a" stroke-width="5" fill="none"/></svg>') no-repeat center center;
            background-size: cover;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            border: 3px solid #8b6914;
        }
        
        .location {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            border: 4px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        .location:hover {
            transform: scale(1.15);
            background: rgba(255, 255, 255, 0.3);
            border-color: #ffd700;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        .location-name {
            font-size: 14px;
            font-weight: bold;
            margin-top: 5px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            color: #fff;
        }
        
        .location-library {
            top: 120px;
            left: 120px;
        }
        
        .location-cave {
            top: 250px;
            left: 280px;
        }
        
        .location-mountain {
            top: 100px;
            left: 480px;
        }
        
        .location-temple {
            top: 280px;
            left: 580px;
        }
        
        .location-treasure {
            top: 180px;
            left: 680px;
            opacity: 0.5;
        }
        
        .location-completed {
            background: rgba(46, 204, 113, 0.4);
            border-color: #2ecc71;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .location-available {
            background: rgba(243, 156, 18, 0.4);
            border-color: #f39c12;
            animation: pulse 2s infinite;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }
        
        .location-locked {
            background: rgba(127, 140, 141, 0.3);
            border-color: #7f8c8d;
            cursor: not-allowed;
            filter: grayscale(0.7);
        }
        
        /* æ•°å­¦è°œé¢˜æ ·å¼ */
        .puzzle-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .puzzle-question {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .puzzle-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .puzzle-option {
            padding: 10px 20px;
            background: rgba(52, 152, 219, 0.7);
            border: 2px solid #3498db;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .puzzle-option:hover {
            background: rgba(52, 152, 219, 0.9);
            transform: translateY(-2px);
        }
        
        .puzzle-input {
            padding: 10px;
            font-size: 1.1rem;
            border: 2px solid #3498db;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            text-align: center;
            width: 150px;
            margin: 10px;
        }
        
        .puzzle-submit {
            padding: 10px 20px;
            background: #2ecc71;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .puzzle-submit:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        /* éŸ³ä¹æ§åˆ¶æ ·å¼ */
        .music-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .music-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .music-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        .music-btn.muted {
            background: rgba(231, 76, 60, 0.7);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes treasureGlow {
            0% { box-shadow: 0 0 5px gold; }
            50% { box-shadow: 0 0 20px gold; }
            100% { box-shadow: 0 0 5px gold; }
        }
        
        .bounce { animation: bounce 0.5s ease; }
        .pulse { animation: pulse 2s infinite; }
        .treasure-glow { animation: treasureGlow 2s infinite; }
        
        .page-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .page-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .page-dot.active {
            background: #f39c12;
            transform: scale(1.2);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .scene {
                height: 200px;
            }
            
            .character {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .book, .temple, .cave, .mountain {
                transform: scale(0.8);
            }
            
            .map-container {
                height: 350px;
            }
            
            .location {
                width: 70px;
                height: 70px;
                font-size: 24px;
            }
            
            .location-name {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-controls">
        <div class="music-btn" id="music-toggle">â™ª</div>
        <div class="music-btn" id="music-mute">ğŸ”‡</div>
    </div>

    <!-- å°é¢é¡µ -->
    <div class="page active" id="cover-page">
        <div class="container">
            <h1 class="animated-text">å¯»å®æ¸¸æˆï¼šå¤è€ç¥åº™çš„è°œé¢˜</h1>
            <div class="scene">
                <div class="scene-content">
                    <div class="character pulse">ğŸ§­</div>
                    <div class="object book">ğŸ“š</div>
                    <div class="object temple">ğŸ›•</div>
                    <div class="object cave">ğŸ•³ï¸</div>
                    <div class="object mountain">â›°ï¸</div>
                    <div class="object treasure">ğŸ’</div>
                </div>
            </div>
            <p>è¸ä¸Šå†’é™©ä¹‹æ—…ï¼Œè§£å¼€å¤è€è°œé¢˜ï¼Œå¯»æ‰¾ä¼ è¯´ä¸­çš„å®è—ï¼</p>
            <div class="controls">
                <button id="start-game">å¼€å§‹æ¸¸æˆ</button>
                <button id="view-map">æŸ¥çœ‹åœ°å›¾</button>
            </div>
        </div>
    </div>
    
    <!-- å…¨æ™¯åœ°å›¾é¡µ -->
    <div class="page" id="map-page">
        <div class="container">
            <h2>å†’é™©åœ°å›¾</h2>
            <div class="map-container">
                <div class="location location-library location-available" data-location="library-page">
                    ğŸ“š
                    <div class="location-name">å¤è€å›¾ä¹¦é¦†</div>
                </div>
                <div class="location location-cave location-locked" data-location="cave-page">
                    ğŸ•³ï¸
                    <div class="location-name">ç¥ç§˜æ´ç©´</div>
                </div>
                <div class="location location-mountain location-locked" data-location="mountain-page">
                    â›°ï¸
                    <div class="location-name">é«˜å±±ä¹‹å·…</div>
                </div>
                <div class="location location-temple location-locked" data-location="temple-page">
                    ğŸ›•
                    <div class="location-name">å¤è€ç¥åº™</div>
                </div>
                <div class="location location-treasure location-locked" data-location="treasure-page">
                    ğŸ’
                    <div class="location-name">å®è—ä¹‹åœ°</div>
                </div>
            </div>
            <p>ç‚¹å‡»åœ°å›¾ä¸Šçš„åœ°ç‚¹è¿›è¡Œæ¢ç´¢ã€‚å·²å®Œæˆçš„åœ°ç‚¹ä¼šæ˜¾ç¤ºä¸ºç»¿è‰²ï¼Œå¯å‰å¾€çš„åœ°ç‚¹ä¼šé—ªçƒï¼Œæœªè§£é”çš„åœ°ç‚¹æ˜¾ç¤ºä¸ºç°è‰²ã€‚</p>
            <div class="controls">
                <button class="nav-btn" data-target="cover-page">è¿”å›</button>
            </div>
        </div>
    </div>
    
    <!-- å›¾ä¹¦é¦†é¡µ -->
    <div class="page" id="library-page">
        <div class="container">
            <h2>å¤è€å›¾ä¹¦é¦†</h2>
            <div class="scene">
                <div class="scene-content">
                    <div class="character" id="library-character">ğŸ§­</div>
                    <div class="object book pulse" id="ancient-book">ğŸ“š</div>
                </div>
            </div>
            <p>ä½ æ¥åˆ°äº†å¤è€çš„å›¾ä¹¦é¦†ï¼Œè¿™é‡Œå……æ»¡äº†å°˜å°çš„ä¹¦ç±å’Œç¥ç§˜çš„æ°”æ¯ã€‚</p>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-1"></div>
                </div>
                <div class="status-text" id="status-text-1">å¯»æ‰¾çº¿ç´¢...</div>
            </div>
            <div class="action-buttons" id="action-buttons-1">
                <button class="action-btn" data-action="search">æœç´¢ä¹¦æ¶</button>
                <button class="action-btn" data-action="examine">æ£€æŸ¥å¤ä¹¦</button>
                <button class="action-btn" data-action="decode">è§£è¯»åœ°å›¾</button>
            </div>
            <div class="message-log" id="message-log-1"></div>
            <div class="controls">
                <button class="nav-btn" data-target="map-page">è¿”å›åœ°å›¾</button>
                <button class="nav-btn" data-target="cave-page" id="next-from-library" disabled>å‰å¾€æ´ç©´</button>
            </div>
        </div>
    </div>
    
    <!-- æ´ç©´é¡µ -->
    <div class="page" id="cave-page">
        <div class="container">
            <h2>ç¥ç§˜æ´ç©´</h2>
            <div class="scene">
                <div class="scene-content">
                    <div class="character" id="cave-character">ğŸ§­</div>
                    <div class="object cave">ğŸ•³ï¸</div>
                </div>
            </div>
            <p>ä½ è¿›å…¥äº†é»‘æš—çš„æ´ç©´ï¼Œè¿™é‡Œå……æ»¡äº†æœªçŸ¥çš„å±é™©å’Œç§˜å¯†ã€‚</p>
            
            <!-- æ•°å­¦è°œé¢˜ -->
            <div class="puzzle-container" id="cave-puzzle" style="display: none;">
                <h3>æ´ç©´è°œé¢˜</h3>
                <p class="puzzle-question" id="cave-question">è§£è°œåæ‰èƒ½ç»§ç»­å‰è¿›...</p>
                <div class="puzzle-options" id="cave-options"></div>
                <input type="number" class="puzzle-input" id="cave-input" placeholder="è¾“å…¥ç­”æ¡ˆ">
                <button class="puzzle-submit" id="cave-submit">æäº¤ç­”æ¡ˆ</button>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-2"></div>
                </div>
                <div class="status-text" id="status-text-2">æ¢ç´¢æ´ç©´...</div>
            </div>
            <div class="action-buttons" id="action-buttons-2">
                <button class="action-btn" data-action="explore">æ·±å…¥æ¢ç´¢</button>
                <button class="action-btn" data-action="paintings">æŸ¥çœ‹å£ç”»</button>
                <button class="action-btn" data-action="search-cave">å¯»æ‰¾çº¿ç´¢</button>
            </div>
            <div class="message-log" id="message-log-2"></div>
            <div class="controls">
                <button class="nav-btn" data-target="map-page">è¿”å›åœ°å›¾</button>
                <button class="nav-btn" data-target="mountain-page" id="next-from-cave" disabled>å‰å¾€é«˜å±±</button>
            </div>
        </div>
    </div>
    
    <!-- é«˜å±±é¡µ -->
    <div class="page" id="mountain-page">
        <div class="container">
            <h2>é«˜å±±ä¹‹å·…</h2>
            <div class="scene">
                <div class="scene-content">
                    <div class="character" id="mountain-character">ğŸ§­</div>
                    <div class="object mountain">â›°ï¸</div>
                </div>
            </div>
            <p>ä½ ç™»ä¸Šäº†é«˜å±±ä¹‹å·…ï¼Œä»è¿™é‡Œå¯ä»¥ä¿¯ç°æ•´ä¸ªå±±è°·ã€‚</p>
            
            <!-- æ•°å­¦è°œé¢˜ -->
            <div class="puzzle-container" id="mountain-puzzle" style="display: none;">
                <h3>é«˜å±±è°œé¢˜</h3>
                <p class="puzzle-question" id="mountain-question">è§£è°œåæ‰èƒ½ç»§ç»­å‰è¿›...</p>
                <div class="puzzle-options" id="mountain-options"></div>
                <input type="number" class="puzzle-input" id="mountain-input" placeholder="è¾“å…¥ç­”æ¡ˆ">
                <button class="puzzle-submit" id="mountain-submit">æäº¤ç­”æ¡ˆ</button>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-3"></div>
                </div>
                <div class="status-text" id="status-text-3">å¯»æ‰¾çº¿ç´¢...</div>
            </div>
            <div class="action-buttons" id="action-buttons-3">
                <button class="action-btn" data-action="search-mountain">æœç´¢å±±é¡¶</button>
                <button class="action-btn" data-action="view">è§‚å¯Ÿåœ°å½¢</button>
                <button class="action-btn" data-action="find-path">å¯»æ‰¾è·¯å¾„</button>
            </div>
            <div class="message-log" id="message-log-3"></div>
            <div class="controls">
                <button class="nav-btn" data-target="map-page">è¿”å›åœ°å›¾</button>
                <button class="nav-btn" data-target="temple-page" id="next-from-mountain" disabled>å‰å¾€ç¥åº™</button>
            </div>
        </div>
    </div>
    
    <!-- ç¥åº™é¡µ -->
    <div class="page" id="temple-page">
        <div class="container">
            <h2>å¤è€ç¥åº™</h2>
            <div class="scene">
                <div class="scene-content">
                    <div class="character" id="temple-character">ğŸ§­</div>
                    <div class="object temple">ğŸ›•</div>
                    <div class="object treasure" id="treasure-chest">ğŸ’</div>
                </div>
            </div>
            <p>ä½ æ¥åˆ°äº†å¤è€çš„ç¥åº™ï¼Œè¿™é‡Œå……æ»¡äº†ç¥ç§˜çš„èƒ½é‡ã€‚</p>
            
            <!-- æ•°å­¦è°œé¢˜ -->
            <div class="puzzle-container" id="temple-puzzle" style="display: none;">
                <h3>ç¥åº™è°œé¢˜</h3>
                <p class="puzzle-question" id="temple-question">è§£è°œåæ‰èƒ½æ‰“å¼€å®ç®±...</p>
                <div class="puzzle-options" id="temple-options"></div>
                <input type="number" class="puzzle-input" id="temple-input" placeholder="è¾“å…¥ç­”æ¡ˆ">
                <button class="puzzle-submit" id="temple-submit">æäº¤ç­”æ¡ˆ</button>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-4"></div>
                </div>
                <div class="status-text" id="status-text-4">è§£å¼€è°œé¢˜...</div>
            </div>
            <div class="action-buttons" id="action-buttons-4">
                <button class="action-btn" data-action="puzzle">è§£å¼€è°œé¢˜</button>
                <button class="action-btn" data-action="key">å¯»æ‰¾é’¥åŒ™</button>
                <button class="action-btn" data-action="open">æ‰“å¼€å®ç®±</button>
            </div>
            <div class="message-log" id="message-log-4"></div>
            <div class="controls">
                <button class="nav-btn" data-target="map-page">è¿”å›åœ°å›¾</button>
                <button class="nav-btn" data-target="treasure-page" id="next-from-temple" disabled>æŸ¥çœ‹å®è—</button>
            </div>
        </div>
    </div>
    
    <!-- å®è—é¡µ -->
    <div class="page" id="treasure-page">
        <div class="container">
            <h2>å®è—å‘ç°</h2>
            <div class="scene">
                <div class="scene-content">
                    <div class="character">ğŸ§­</div>
                    <div class="object treasure treasure-glow" style="opacity: 1; transform: scale(1.5);">ğŸ’</div>
                </div>
            </div>
            <p>æ­å–œä½ ï¼ä½ æˆåŠŸæ‰¾åˆ°äº†ä¼ è¯´ä¸­çš„å®è—ï¼</p>
            <div class="message-log" id="message-log-5">
                <div class="message success">ä½ è§£å¼€äº†æ‰€æœ‰è°œé¢˜ï¼Œæ‰¾åˆ°äº†æ™ºæ…§ä¹‹çŸ³ï¼</div>
                <div class="message success">è¿™é¢—å®çŸ³å°†èµ‹äºˆä½ æ— å°½çš„çŸ¥è¯†å’Œæ™ºæ…§ï¼</div>
            </div>
            <div class="controls">
                <button id="play-again">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
    </div>
    
    <!-- é¡µé¢æŒ‡ç¤ºå™¨ -->
    <div class="page-indicator">
        <div class="page-dot active" data-page="cover-page"></div>
        <div class="page-dot" data-page="map-page"></div>
        <div class="page-dot" data-page="library-page"></div>
        <div class="page-dot" data-page="cave-page"></div>
        <div class="page-dot" data-page="mountain-page"></div>
        <div class="page-dot" data-page="temple-page"></div>
        <div class="page-dot" data-page="treasure-page"></div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="background-music" loop>
        <source src="music.mp4" type="audio/mp4">
        <source src="music.mp4" type="audio/mpeg">
    </audio>
    <audio id="library-music" loop>
        <source src="music.mp4" type="audio/mp4">
        <source src="music.mp4" type="audio/mpeg">
    </audio>
    <audio id="cave-music" loop>
        <source src="music.mp4" type="audio/mp4">
        <source src="music.mp4" type="audio/mpeg">
    </audio>
    <audio id="mountain-music" loop>
        <source src="music.mp4" type="audio/mp4">
        <source src="music.mp4" type="audio/mpeg">
    </audio>
    <audio id="temple-music" loop>
        <source src="music.mp4" type="audio/mp4">
        <source src="music.mp4" type="audio/mpeg">
    </audio>
    <audio id="treasure-music" loop>
        <source src="music.mp4" type="audio/mp4">
        <source src="music.mp4" type="audio/mpeg">
    </audio>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        class TreasureGame {
            constructor() {
                this.currentPage = 'cover-page';
                this.pages = [
                    'cover-page', 
                    'map-page',
                    'library-page', 
                    'cave-page', 
                    'mountain-page', 
                    'temple-page', 
                    'treasure-page'
                ];
                
                // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¸¸æˆçŠ¶æ€
                this.gameState = this.loadGameState() || {
                    hasMap: false,
                    hasDecodedMap: false,
                    hasCaveClue: false,
                    hasMountainClue: false,
                    hasKey: false,
                    hasSolvedPuzzle: false,
                    hasFoundTreasure: false,
                    currentPage: 'cover-page',
                    unlockedLocations: ['library-page'],
                    solvedPuzzles: {
                        cave: false,
                        mountain: false,
                        temple: false
                    }
                };
                
                // éŸ³é¢‘å…ƒç´ 
                this.backgroundMusic = document.getElementById('background-music');
                this.libraryMusic = document.getElementById('library-music');
                this.caveMusic = document.getElementById('cave-music');
                this.mountainMusic = document.getElementById('mountain-music');
                this.templeMusic = document.getElementById('temple-music');
                this.treasureMusic = document.getElementById('treasure-music');
                
                // éŸ³ä¹çŠ¶æ€
                this.musicEnabled = true;
                this.muted = false;
                
                // æ•°å­¦è°œé¢˜
                this.puzzles = {
                    cave: {
                        question: "å¦‚æœæˆ‘æœ‰3ä¸ªè‹¹æœï¼Œä½ ç»™æˆ‘2ä¸ªï¼Œç„¶åæˆ‘åƒæ‰1ä¸ªï¼Œæˆ‘è¿˜å‰©å‡ ä¸ªè‹¹æœï¼Ÿ",
                        answer: 4,
                        options: [3, 4, 5, 6]
                    },
                    mountain: {
                        question: "15 + 27 ç­‰äºå¤šå°‘ï¼Ÿ",
                        answer: 42,
                        options: [40, 41, 42, 43]
                    },
                    temple: {
                        question: "ä¸€ä¸ªæ­£æ–¹å½¢çš„è¾¹é•¿æ˜¯5ï¼Œå®ƒçš„é¢ç§¯æ˜¯å¤šå°‘ï¼Ÿ",
                        answer: 25,
                        options: [20, 25, 30, 35]
                    }
                };
                
                this.initializeEventListeners();
                this.initializePageIndicator();
                this.updateMapLocations();
                
                // æ¢å¤ä¸Šæ¬¡çš„æ¸¸æˆé¡µé¢
                if (this.gameState.currentPage && this.gameState.currentPage !== 'cover-page') {
                    this.navigateTo(this.gameState.currentPage);
                }
                
                // æ¢å¤è¿›åº¦æ¡çŠ¶æ€
                this.restoreProgressBars();
            }
            
            initializeEventListeners() {
                // å¼€å§‹æ¸¸æˆæŒ‰é’®
                document.getElementById('start-game').addEventListener('click', () => {
                    this.navigateTo('library-page');
                });
                
                // æŸ¥çœ‹åœ°å›¾æŒ‰é’®
                document.getElementById('view-map').addEventListener('click', () => {
                    this.navigateTo('map-page');
                });
                
                // å†ç©ä¸€æ¬¡æŒ‰é’®
                document.getElementById('play-again').addEventListener('click', () => {
                    this.resetGame();
                    this.navigateTo('cover-page');
                });
                
                // å¯¼èˆªæŒ‰é’®
                document.querySelectorAll('.nav-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const targetPage = e.target.getAttribute('data-target');
                        this.navigateTo(targetPage);
                    });
                });
                
                // åœ°å›¾ä½ç½®ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.location').forEach(location => {
                    location.addEventListener('click', (e) => {
                        const targetPage = e.currentTarget.getAttribute('data-location');
                        if (!e.currentTarget.classList.contains('location-locked')) {
                            this.navigateTo(targetPage);
                        }
                    });
                });
                
                // éŸ³ä¹æ§åˆ¶
                document.getElementById('music-toggle').addEventListener('click', () => {
                    this.toggleMusic();
                });
                
                document.getElementById('music-mute').addEventListener('click', () => {
                    this.toggleMute();
                });
                
                // æ•°å­¦è°œé¢˜æäº¤æŒ‰é’®
                document.getElementById('cave-submit').addEventListener('click', () => {
                    this.checkPuzzleAnswer('cave');
                });
                
                document.getElementById('mountain-submit').addEventListener('click', () => {
                    this.checkPuzzleAnswer('mountain');
                });
                
                document.getElementById('temple-submit').addEventListener('click', () => {
                    this.checkPuzzleAnswer('temple');
                });
                
                // å„é¡µé¢çš„åŠ¨ä½œæŒ‰é’®
                this.initializeActionButtons();
                
                // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶ä¿å­˜æ¸¸æˆçŠ¶æ€
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.saveGameState();
                    }
                });
                
                // çª—å£å…³é—­å‰ä¿å­˜æ¸¸æˆçŠ¶æ€
                window.addEventListener('beforeunload', () => {
                    this.saveGameState();
                });
            }
            
            initializeActionButtons() {
                // å›¾ä¹¦é¦†é¡µé¢åŠ¨ä½œ
                document.querySelectorAll('#action-buttons-1 button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.target.getAttribute('data-action');
                        this.performLibraryAction(action);
                    });
                });
                
                // æ´ç©´é¡µé¢åŠ¨ä½œ
                document.querySelectorAll('#action-buttons-2 button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.target.getAttribute('data-action');
                        this.performCaveAction(action);
                    });
                });
                
                // é«˜å±±é¡µé¢åŠ¨ä½œ
                document.querySelectorAll('#action-buttons-3 button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.target.getAttribute('data-action');
                        this.performMountainAction(action);
                    });
                });
                
                // ç¥åº™é¡µé¢åŠ¨ä½œ
                document.querySelectorAll('#action-buttons-4 button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.target.getAttribute('data-action');
                        this.performTempleAction(action);
                    });
                });
            }
            
            initializePageIndicator() {
                const dots = document.querySelectorAll('.page-dot');
                dots.forEach(dot => {
                    dot.addEventListener('click', () => {
                        const page = dot.getAttribute('data-page');
                        this.navigateTo(page);
                    });
                });
            }
            
            navigateTo(pageId) {
                // æ›´æ–°å½“å‰é¡µé¢çŠ¶æ€
                this.gameState.currentPage = pageId;
                
                // æ›´æ–°é¡µé¢æŒ‡ç¤ºå™¨
                document.querySelectorAll('.page-dot').forEach(dot => {
                    dot.classList.remove('active');
                    if (dot.getAttribute('data-page') === pageId) {
                        dot.classList.add('active');
                    }
                });
                
                // éšè—å½“å‰é¡µé¢
                const currentPage = document.getElementById(this.currentPage);
                currentPage.classList.remove('active');
                currentPage.classList.add('previous');
                
                // æ˜¾ç¤ºæ–°é¡µé¢
                const newPage = document.getElementById(pageId);
                newPage.classList.remove('previous');
                newPage.classList.add('active');
                
                this.currentPage = pageId;
                
                // ä¸ºæ–°é¡µé¢æ·»åŠ åŠ¨ç”»
                this.animatePageContent(pageId);
                
                // æ’­æ”¾å¯¹åº”é¡µé¢çš„éŸ³ä¹
                this.playPageMusic(pageId);
                
                // ä¿å­˜æ¸¸æˆçŠ¶æ€
                this.saveGameState();
            }
            
            playPageMusic(pageId) {
                // åœæ­¢æ‰€æœ‰éŸ³ä¹
                this.backgroundMusic.pause();
                this.libraryMusic.pause();
                this.caveMusic.pause();
                this.mountainMusic.pause();
                this.templeMusic.pause();
                this.treasureMusic.pause();
                
                if (!this.musicEnabled || this.muted) return;
                
                // æ’­æ”¾å¯¹åº”é¡µé¢çš„éŸ³ä¹
                switch(pageId) {
                    case 'cover-page':
                        this.backgroundMusic.currentTime = 0;
                        this.backgroundMusic.play();
                        break;
                    case 'map-page':
                        this.backgroundMusic.currentTime = 0;
                        this.backgroundMusic.play();
                        break;
                    case 'library-page':
                        this.libraryMusic.currentTime = 0;
                        this.libraryMusic.play();
                        break;
                    case 'cave-page':
                        this.caveMusic.currentTime = 0;
                        this.caveMusic.play();
                        break;
                    case 'mountain-page':
                        this.mountainMusic.currentTime = 0;
                        this.mountainMusic.play();
                        break;
                    case 'temple-page':
                        this.templeMusic.currentTime = 0;
                        this.templeMusic.play();
                        break;
                    case 'treasure-page':
                        this.treasureMusic.currentTime = 0;
                        this.treasureMusic.play();
                        break;
                }
            }
            
            toggleMusic() {
                this.musicEnabled = !this.musicEnabled;
                if (this.musicEnabled) {
                    this.playPageMusic(this.currentPage);
                } else {
                    this.backgroundMusic.pause();
                    this.libraryMusic.pause();
                    this.caveMusic.pause();
                    this.mountainMusic.pause();
                    this.templeMusic.pause();
                    this.treasureMusic.pause();
                }
            }
            
            toggleMute() {
                this.muted = !this.muted;
                const muteButton = document.getElementById('music-mute');
                
                if (this.muted) {
                    muteButton.classList.add('muted');
                    muteButton.textContent = 'ğŸ”‡';
                    this.backgroundMusic.volume = 0;
                    this.libraryMusic.volume = 0;
                    this.caveMusic.volume = 0;
                    this.mountainMusic.volume = 0;
                    this.templeMusic.volume = 0;
                    this.treasureMusic.volume = 0;
                } else {
                    muteButton.classList.remove('muted');
                    muteButton.textContent = 'ğŸ”Š';
                    this.backgroundMusic.volume = 1;
                    this.libraryMusic.volume = 1;
                    this.caveMusic.volume = 1;
                    this.mountainMusic.volume = 1;
                    this.templeMusic.volume = 1;
                    this.treasureMusic.volume = 1;
                }
            }
            
            showPuzzle(puzzleType) {
                const puzzle = this.puzzles[puzzleType];
                const puzzleContainer = document.getElementById(`${puzzleType}-puzzle`);
                const questionElement = document.getElementById(`${puzzleType}-question`);
                const optionsContainer = document.getElementById(`${puzzleType}-options`);
                
                // æ˜¾ç¤ºè°œé¢˜
                puzzleContainer.style.display = 'block';
                questionElement.textContent = puzzle.question;
                
                // æ¸…ç©ºé€‰é¡¹
                optionsContainer.innerHTML = '';
                
                // æ·»åŠ é€‰é¡¹
                puzzle.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'puzzle-option';
                    optionElement.textContent = option;
                    optionElement.addEventListener('click', () => {
                        document.getElementById(`${puzzleType}-input`).value = option;
                    });
                    optionsContainer.appendChild(optionElement);
                });
            }
            
            checkPuzzleAnswer(puzzleType) {
                const inputElement = document.getElementById(`${puzzleType}-input`);
                const userAnswer = parseInt(inputElement.value);
                const correctAnswer = this.puzzles[puzzleType].answer;
                const messageLog = document.getElementById(`message-log-${this.getPageNumber(puzzleType)}`);
                
                if (userAnswer === correctAnswer) {
                    this.addMessage(messageLog, "ç­”æ¡ˆæ­£ç¡®ï¼è°œé¢˜è§£å¼€äº†ï¼", 'success');
                    this.gameState.solvedPuzzles[puzzleType] = true;
                    document.getElementById(`${puzzleType}-puzzle`).style.display = 'none';
                    
                    // æ ¹æ®è°œé¢˜ç±»å‹æ›´æ–°æ¸¸æˆçŠ¶æ€
                    if (puzzleType === 'cave') {
                        this.gameState.hasKey = true;
                        document.getElementById('progress-fill-2').style.width = '100%';
                        document.getElementById('next-from-cave').disabled = false;
                        
                        // è§£é”é«˜å±±
                        if (!this.gameState.unlockedLocations.includes('mountain-page')) {
                            this.gameState.unlockedLocations.push('mountain-page');
                            this.updateMapLocations();
                        }
                    } else if (puzzleType === 'mountain') {
                        this.gameState.hasMountainClue = true;
                        document.getElementById('progress-fill-3').style.width = '100%';
                        document.getElementById('next-from-mountain').disabled = false;
                        
                        // è§£é”ç¥åº™
                        if (!this.gameState.unlockedLocations.includes('temple-page')) {
                            this.gameState.unlockedLocations.push('temple-page');
                            this.updateMapLocations();
                        }
                    } else if (puzzleType === 'temple') {
                        this.gameState.hasSolvedPuzzle = true;
                        document.getElementById('progress-fill-4').style.width = '100%';
                        document.getElementById('next-from-temple').disabled = false;
                        
                        // è§£é”å®è—é¡µ
                        if (!this.gameState.unlockedLocations.includes('treasure-page')) {
                            this.gameState.unlockedLocations.push('treasure-page');
                            this.updateMapLocations();
                        }
                    }
                    
                    this.saveGameState();
                } else {
                    this.addMessage(messageLog, "ç­”æ¡ˆé”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼", 'danger');
                }
            }
            
            getPageNumber(puzzleType) {
                switch(puzzleType) {
                    case 'cave': return 2;
                    case 'mountain': return 3;
                    case 'temple': return 4;
                    default: return 1;
                }
            }
            
            animatePageContent(pageId) {
                switch(pageId) {
                    case 'library-page':
                        this.animateLibrary();
                        break;
                    case 'cave-page':
                        this.animateCave();
                        break;
                    case 'mountain-page':
                        this.animateMountain();
                        break;
                    case 'temple-page':
                        this.animateTemple();
                        break;
                    case 'treasure-page':
                        this.animateTreasure();
                        break;
                }
            }
            
            animateLibrary() {
                const character = document.getElementById('library-character');
                const book = document.getElementById('ancient-book');
                
                // é‡ç½®ä½ç½®
                character.style.left = '100px';
                character.style.top = '150px';
                
                // åŠ¨ç”»ï¼šè§’è‰²ç§»åŠ¨åˆ°ä¹¦çš„ä½ç½®
                setTimeout(() => {
                    character.style.left = '180px';
                    character.style.top = '120px';
                    character.classList.add('bounce');
                    
                    setTimeout(() => {
                        character.classList.remove('bounce');
                    }, 500);
                }, 500);
            }
            
            animateCave() {
                const character = document.getElementById('cave-character');
                
                // é‡ç½®ä½ç½®
                character.style.left = '300px';
                character.style.top = '100px';
                
                // åŠ¨ç”»ï¼šè§’è‰²ç§»åŠ¨åˆ°æ´ç©´
                setTimeout(() => {
                    character.style.left = '150px';
                    character.style.top = '150px';
                    character.classList.add('bounce');
                    
                    setTimeout(() => {
                        character.classList.remove('bounce');
                    }, 500);
                }, 500);
            }
            
            animateMountain() {
                const character = document.getElementById('mountain-character');
                
                // é‡ç½®ä½ç½®
                character.style.left = '100px';
                character.style.top = '100px';
                
                // åŠ¨ç”»ï¼šè§’è‰²ç§»åŠ¨åˆ°å±±é¡¶
                setTimeout(() => {
                    character.style.left = '400px';
                    character.style.top = '80px';
                    character.classList.add('bounce');
                    
                    setTimeout(() => {
                        character.classList.remove('bounce');
                    }, 500);
                }, 500);
            }
            
            animateTemple() {
                const character = document.getElementById('temple-character');
                const treasure = document.getElementById('treasure-chest');
                
                // é‡ç½®ä½ç½®
                character.style.left = '100px';
                character.style.top = '150px';
                treasure.style.opacity = '0';
                treasure.style.transform = 'scale(0)';
                
                // åŠ¨ç”»ï¼šè§’è‰²ç§»åŠ¨åˆ°ç¥åº™
                setTimeout(() => {
                    character.style.left = '500px';
                    character.style.top = '150px';
                    character.classList.add('bounce');
                    
                    setTimeout(() => {
                        character.classList.remove('bounce');
                        
                        // æ˜¾ç¤ºå®è—
                        if (this.gameState.hasKey && this.gameState.hasSolvedPuzzle) {
                            treasure.style.opacity = '1';
                            treasure.style.transform = 'scale(1)';
                            treasure.classList.add('pulse');
                        }
                    }, 500);
                }, 500);
            }
            
            animateTreasure() {
                const treasure = document.querySelector('#treasure-page .treasure');
                treasure.classList.add('treasure-glow');
            }
            
            async performLibraryAction(action) {
                const messageLog = document.getElementById('message-log-1');
                const nextButton = document.getElementById('next-from-library');
                const progressFill = document.getElementById('progress-fill-1');
                const statusText = document.getElementById('status-text-1');
                
                // ç¦ç”¨æ‰€æœ‰åŠ¨ä½œæŒ‰é’®
                document.querySelectorAll('#action-buttons-1 button').forEach(btn => {
                    btn.disabled = true;
                });
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                await this.delay(1000);
                
                let message;
                
                switch(action) {
                    case 'search':
                        message = "ä½ åœ¨ä¹¦æ¶ä¸Šæ‰¾åˆ°äº†ä¸€å¼ å¤è€çš„åœ°å›¾ï¼";
                        this.gameState.hasMap = true;
                        progressFill.style.width = '33%';
                        statusText.textContent = "æ‰¾åˆ°åœ°å›¾ï¼";
                        break;
                    case 'examine':
                        message = "ä½ å‘ç°å¤ä¹¦ä¸­è®°è½½äº†ç¥åº™çš„ç§˜å¯†å…¥å£ï¼";
                        this.gameState.hasDecodedMap = true;
                        progressFill.style.width = '66%';
                        statusText.textContent = "è·å¾—é‡è¦çº¿ç´¢ï¼";
                        break;
                    case 'decode':
                        if (this.gameState.hasMap) {
                            message = "ä½ æˆåŠŸè§£è¯»äº†åœ°å›¾ï¼Œå‘ç°å®è—è—åœ¨ç¥åº™ä¸­ï¼";
                            progressFill.style.width = '100%';
                            statusText.textContent = "åœ°å›¾è§£è¯»å®Œæˆï¼";
                            nextButton.disabled = false;
                            
                            // è§£é”æ´ç©´
                            if (!this.gameState.unlockedLocations.includes('cave-page')) {
                                this.gameState.unlockedLocations.push('cave-page');
                                this.updateMapLocations();
                            }
                        } else {
                            message = "ä½ éœ€è¦å…ˆæ‰¾åˆ°åœ°å›¾æ‰èƒ½è¿›è¡Œè§£è¯»ï¼";
                            this.addMessage(messageLog, message, 'danger');
                            
                            // é‡æ–°å¯ç”¨æŒ‰é’®
                            document.querySelectorAll('#action-buttons-1 button').forEach(btn => {
                                btn.disabled = false;
                            });
                            return;
                        }
                        break;
                }
                
                this.addMessage(messageLog, message, 'success');
                
                // å¦‚æœå·²ç»å®Œæˆæ‰€æœ‰æ¡ä»¶ï¼Œå¯ç”¨ç»§ç»­æŒ‰é’®
                if (this.gameState.hasMap && this.gameState.hasDecodedMap) {
                    nextButton.disabled = false;
                }
                
                // é‡æ–°å¯ç”¨æŒ‰é’®
                document.querySelectorAll('#action-buttons-1 button').forEach(btn => {
                    btn.disabled = false;
                });
                
                // ä¿å­˜æ¸¸æˆçŠ¶æ€
                this.saveGameState();
            }
            
            async performCaveAction(action) {
                const messageLog = document.getElementById('message-log-2');
                const nextButton = document.getElementById('next-from-cave');
                const progressFill = document.getElementById('progress-fill-2');
                const statusText = document.getElementById('status-text-2');
                
                // ç¦ç”¨æ‰€æœ‰åŠ¨ä½œæŒ‰é’®
                document.querySelectorAll('#action-buttons-2 button').forEach(btn => {
                    btn.disabled = true;
                });
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                await this.delay(1000);
                
                let message;
                
                switch(action) {
                    case 'explore':
                        message = "ä½ åœ¨æ´ç©´æ·±å¤„å‘ç°äº†ä¸€å¹…ç¥ç§˜çš„å£ç”»ï¼";
                        this.gameState.hasCaveClue = true;
                        progressFill.style.width = '33%';
                        statusText.textContent = "å‘ç°å£ç”»ï¼";
                        break;
                    case 'paintings':
                        if (this.gameState.hasCaveClue) {
                            message = "å£ç”»æ˜¾ç¤ºå®è—è—åœ¨ç¥åº™æ·±å¤„ï¼";
                            progressFill.style.width = '66%';
                            statusText.textContent = "è§£è¯»å£ç”»æˆåŠŸï¼";
                        } else {
                            message = "ä½ éœ€è¦å…ˆæ¢ç´¢æ´ç©´æ‰¾åˆ°å£ç”»ï¼";
                            this.addMessage(messageLog, message, 'danger');
                            
                            // é‡æ–°å¯ç”¨æŒ‰é’®
                            document.querySelectorAll('#action-buttons-2 button').forEach(btn => {
                                btn.disabled = false;
                            });
                            return;
                        }
                        break;
                    case 'search-cave':
                        if (!this.gameState.solvedPuzzles.cave) {
                            this.showPuzzle('cave');
                            message = "ä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„æ•°å­¦è°œé¢˜ï¼è§£è°œåæ‰èƒ½æ‰¾åˆ°é’¥åŒ™ã€‚";
                        } else {
                            message = "ä½ å·²ç»æ‰¾åˆ°äº†é’¥åŒ™ï¼";
                        }
                        break;
                }
                
                this.addMessage(messageLog, message, 'success');
                
                // å¦‚æœå·²ç»å®Œæˆæ‰€æœ‰æ¡ä»¶ï¼Œå¯ç”¨ç»§ç»­æŒ‰é’®
                if (this.gameState.hasCaveClue && this.gameState.hasKey) {
                    nextButton.disabled = false;
                }
                
                // é‡æ–°å¯ç”¨æŒ‰é’®
                document.querySelectorAll('#action-buttons-2 button').forEach(btn => {
                    btn.disabled = false;
                });
                
                // ä¿å­˜æ¸¸æˆçŠ¶æ€
                this.saveGameState();
            }
            
            async performMountainAction(action) {
                const messageLog = document.getElementById('message-log-3');
                const nextButton = document.getElementById('next-from-mountain');
                const progressFill = document.getElementById('progress-fill-3');
                const statusText = document.getElementById('status-text-3');
                
                // ç¦ç”¨æ‰€æœ‰åŠ¨ä½œæŒ‰é’®
                document.querySelectorAll('#action-buttons-3 button').forEach(btn => {
                    btn.disabled = true;
                });
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                await this.delay(1000);
                
                let message;
                
                switch(action) {
                    case 'search-mountain':
                        message = "ä½ åœ¨å±±é¡¶æ‰¾åˆ°äº†ç¥åº™çš„éšè—å…¥å£ï¼";
                        this.gameState.hasMountainClue = true;
                        progressFill.style.width = '33%';
                        statusText.textContent = "å‘ç°å…¥å£ï¼";
                        break;
                    case 'view':
                        if (this.gameState.hasMountainClue) {
                            message = "ä½ ä»å±±é¡¶çœ‹åˆ°äº†ç¥åº™çš„å…¨è²Œï¼";
                            progressFill.style.width = '66%';
                            statusText.textContent = "è§‚å¯Ÿå®Œæˆï¼";
                        } else {
                            message = "ä½ éœ€è¦å…ˆæœç´¢å±±é¡¶æ‰¾åˆ°å…¥å£ï¼";
                            this.addMessage(messageLog, message, 'danger');
                            
                            // é‡æ–°å¯ç”¨æŒ‰é’®
                            document.querySelectorAll('#action-buttons-3 button').forEach(btn => {
                                btn.disabled = false;
                            });
                            return;
                        }
                        break;
                    case 'find-path':
                        if (!this.gameState.solvedPuzzles.mountain) {
                            this.showPuzzle('mountain');
                            message = "ä½ å‘ç°äº†ä¸€ä¸ªæ•°å­¦è°œé¢˜ï¼è§£è°œåæ‰èƒ½æ‰¾åˆ°é€šå¾€ç¥åº™çš„è·¯å¾„ã€‚";
                        } else {
                            message = "ä½ å·²ç»æ‰¾åˆ°äº†é€šå¾€ç¥åº™çš„è·¯å¾„ï¼";
                        }
                        break;
                }
                
                this.addMessage(messageLog, message, 'success');
                
                // å¦‚æœå·²ç»å®Œæˆæ‰€æœ‰æ¡ä»¶ï¼Œå¯ç”¨ç»§ç»­æŒ‰é’®
                if (this.gameState.hasMountainClue) {
                    nextButton.disabled = false;
                }
                
                // é‡æ–°å¯ç”¨æŒ‰é’®
                document.querySelectorAll('#action-buttons-3 button').forEach(btn => {
                    btn.disabled = false;
                });
                
                // ä¿å­˜æ¸¸æˆçŠ¶æ€
                this.saveGameState();
            }
            
            async performTempleAction(action) {
                const messageLog = document.getElementById('message-log-4');
                const nextButton = document.getElementById('next-from-temple');
                const progressFill = document.getElementById('progress-fill-4');
                const statusText = document.getElementById('status-text-4');
                const treasure = document.getElementById('treasure-chest');
                
                // ç¦ç”¨æ‰€æœ‰åŠ¨ä½œæŒ‰é’®
                document.querySelectorAll('#action-buttons-4 button').forEach(btn => {
                    btn.disabled = true;
                });
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                await this.delay(1000);
                
                let message;
                
                switch(action) {
                    case 'puzzle':
                        if (!this.gameState.solvedPuzzles.temple) {
                            this.showPuzzle('temple');
                            message = "ä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„æ•°å­¦è°œé¢˜ï¼è§£è°œåæ‰èƒ½æ‰“å¼€å®ç®±ã€‚";
                        } else {
                            message = "ä½ å·²ç»è§£å¼€äº†ç¥åº™çš„è°œé¢˜ï¼";
                        }
                        break;
                    case 'key':
                        if (this.gameState.hasKey) {
                            message = "ä½ å·²ç»æœ‰äº†é’¥åŒ™ï¼";
                            progressFill.style.width = '66%';
                            statusText.textContent = "é’¥åŒ™å·²å‡†å¤‡ï¼";
                        } else {
                            message = "ä½ éœ€è¦åœ¨æ´ç©´ä¸­å¯»æ‰¾é’¥åŒ™ï¼";
                            this.addMessage(messageLog, message, 'danger');
                            
                            // é‡æ–°å¯ç”¨æŒ‰é’®
                            document.querySelectorAll('#action-buttons-4 button').forEach(btn => {
                                btn.disabled = false;
                            });
                            return;
                        }
                        break;
                    case 'open':
                        if (this.gameState.hasKey && this.gameState.hasSolvedPuzzle) {
                            message = "å®ç®±æ‰“å¼€äº†ï¼é‡Œé¢æ˜¯ä¼ è¯´ä¸­çš„æ™ºæ…§ä¹‹çŸ³ï¼";
                            progressFill.style.width = '100%';
                            statusText.textContent = "å®è—æ‰¾åˆ°ï¼";
                            
                            // æ˜¾ç¤ºå®è—åŠ¨ç”»
                            treasure.style.opacity = '1';
                            treasure.style.transform = 'scale(1)';
                            treasure.classList.add('pulse');
                            
                            // è§£é”å®è—é¡µ
                            if (!this.gameState.unlockedLocations.includes('treasure-page')) {
                                this.gameState.unlockedLocations.push('treasure-page');
                                this.updateMapLocations();
                            }
                            
                            // å¯ç”¨ç»§ç»­æŒ‰é’®
                            nextButton.disabled = false;
                        } else {
                            message = "ä½ éœ€è¦å…ˆæ‰¾åˆ°é’¥åŒ™å¹¶è§£å¼€è°œé¢˜æ‰èƒ½æ‰“å¼€å®ç®±ï¼";
                            this.addMessage(messageLog, message, 'danger');
                            
                            // é‡æ–°å¯ç”¨æŒ‰é’®
                            document.querySelectorAll('#action-buttons-4 button').forEach(btn => {
                                btn.disabled = false;
                            });
                            return;
                        }
                        break;
                }
                
                this.addMessage(messageLog, message, 'success');
                
                // å¦‚æœå·²ç»å®Œæˆæ‰€æœ‰æ¡ä»¶ï¼Œå¯ç”¨ç»§ç»­æŒ‰é’®
                if (this.gameState.hasKey && this.gameState.hasSolvedPuzzle && action === 'open') {
                    nextButton.disabled = false;
                }
                
                // é‡æ–°å¯ç”¨æŒ‰é’®
                document.querySelectorAll('#action-buttons-4 button').forEach(btn => {
                    btn.disabled = false;
                });
                
                // ä¿å­˜æ¸¸æˆçŠ¶æ€
                this.saveGameState();
            }
            
            updateMapLocations() {
                const locations = document.querySelectorAll('.location');
                
                locations.forEach(location => {
                    const locationId = location.getAttribute('data-location');
                    
                    // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
                    location.classList.remove('location-completed', 'location-available', 'location-locked');
                    
                    // è®¾ç½®çŠ¶æ€
                    if (this.gameState.unlockedLocations.includes(locationId)) {
                        if (locationId === 'treasure-page' && this.gameState.hasFoundTreasure) {
                            location.classList.add('location-completed');
                        } else if (locationId === this.currentPage) {
                            location.classList.add('location-available');
                        } else {
                            location.classList.add('location-completed');
                        }
                    } else {
                        location.classList.add('location-locked');
                    }
                });
            }
            
            addMessage(messageLog, text, type = '') {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${type}`;
                messageElement.textContent = text;
                messageLog.appendChild(messageElement);
                messageLog.scrollTop = messageLog.scrollHeight;
            }
            
            saveGameState() {
                try {
                    localStorage.setItem('treasureGameState', JSON.stringify(this.gameState));
                } catch (e) {
                    console.error('ä¿å­˜æ¸¸æˆçŠ¶æ€å¤±è´¥:', e);
                }
            }
            
            loadGameState() {
                try {
                    const savedState = localStorage.getItem('treasureGameState');
                    return savedState ? JSON.parse(savedState) : null;
                } catch (e) {
                    console.error('åŠ è½½æ¸¸æˆçŠ¶æ€å¤±è´¥:', e);
                    return null;
                }
            }
            
            restoreProgressBars() {
                // æ¢å¤å›¾ä¹¦é¦†è¿›åº¦
                if (this.gameState.hasMap) {
                    document.getElementById('progress-fill-1').style.width = '33%';
                }
                if (this.gameState.hasDecodedMap) {
                    document.getElementById('progress-fill-1').style.width = '66%';
                }
                if (this.gameState.hasMap && this.gameState.hasDecodedMap) {
                    document.getElementById('progress-fill-1').style.width = '100%';
                    document.getElementById('next-from-library').disabled = false;
                }
                
                // æ¢å¤æ´ç©´è¿›åº¦
                if (this.gameState.hasCaveClue) {
                    document.getElementById('progress-fill-2').style.width = '33%';
                }
                if (this.gameState.hasKey) {
                    document.getElementById('progress-fill-2').style.width = '100%';
                    document.getElementById('next-from-cave').disabled = false;
                }
                
                // æ¢å¤é«˜å±±è¿›åº¦
                if (this.gameState.hasMountainClue) {
                    document.getElementById('progress-fill-3').style.width = '33%';
                    document.getElementById('next-from-mountain').disabled = false;
                }
                
                // æ¢å¤ç¥åº™è¿›åº¦
                if (this.gameState.hasSolvedPuzzle) {
                    document.getElementById('progress-fill-4').style.width = '33%';
                }
                if (this.gameState.hasKey) {
                    document.getElementById('progress-fill-4').style.width = '66%';
                }
                if (this.gameState.hasKey && this.gameState.hasSolvedPuzzle) {
                    document.getElementById('progress-fill-4').style.width = '100%';
                    document.getElementById('next-from-temple').disabled = false;
                }
            }
            
            resetGame() {
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                this.gameState = {
                    hasMap: false,
                    hasDecodedMap: false,
                    hasCaveClue: false,
                    hasMountainClue: false,
                    hasKey: false,
                    hasSolvedPuzzle: false,
                    hasFoundTreasure: false,
                    currentPage: 'cover-page',
                    unlockedLocations: ['library-page'],
                    solvedPuzzles: {
                        cave: false,
                        mountain: false,
                        temple: false
                    }
                };
                
                // é‡ç½®è¿›åº¦æ¡
                document.querySelectorAll('.progress-fill').forEach(fill => {
                    fill.style.width = '0%';
                });
                
                // é‡ç½®çŠ¶æ€æ–‡æœ¬
                document.querySelectorAll('.status-text').forEach(text => {
                    if (text.id === 'status-text-1') text.textContent = 'å¯»æ‰¾çº¿ç´¢...';
                    if (text.id === 'status-text-2') text.textContent = 'æ¢ç´¢æ´ç©´...';
                    if (text.id === 'status-text-3') text.textContent = 'å¯»æ‰¾çº¿ç´¢...';
                    if (text.id === 'status-text-4') text.textContent = 'è§£å¼€è°œé¢˜...';
                });
                
                // æ¸…ç©ºæ¶ˆæ¯æ—¥å¿—
                document.querySelectorAll('.message-log').forEach(log => {
                    if (log.id !== 'message-log-5') log.innerHTML = '';
                });
                
                // éšè—æ‰€æœ‰è°œé¢˜
                document.querySelectorAll('.puzzle-container').forEach(puzzle => {
                    puzzle.style.display = 'none';
                });
                
                // æ¸…ç©ºè°œé¢˜è¾“å…¥
                document.querySelectorAll('.puzzle-input').forEach(input => {
                    input.value = '';
                });
                
                // ç¦ç”¨ç»§ç»­æŒ‰é’®
                document.querySelectorAll('.nav-btn[data-target]').forEach(btn => {
                    if (!btn.getAttribute('data-target').includes('cover-page') && 
                        !btn.getAttribute('data-target').includes('library-page')) {
                        btn.disabled = true;
                    }
                });
                
                // å¯ç”¨åŠ¨ä½œæŒ‰é’®
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.disabled = false;
                });
                
                // æ›´æ–°åœ°å›¾
                this.updateMapLocations();
                
                // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
                localStorage.removeItem('treasureGameState');
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            new TreasureGame();
        });
    </script>
</body>
</html>